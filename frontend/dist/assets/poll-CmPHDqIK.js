import{_ as P,r as c,f as S,o as p,c as w,a as l,n as h,u as _,g,t as B,p as N,d as z,e as O}from"./_plugin-vue_export-helper-DUaCvcyY.js";import{v as j,A as y,d as V,g as A}from"./poll_loader-glaRrpo0.js";import{h as E,e as Y}from"./edit-B0qfXUHy.js";const J="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='white'%20d='M2%2021v-2h20v2zm1-3v-7h3v7zm5%200V6h3v12zm5%200V9h3v9zm5%200V3h3v15z'/%3e%3c/svg%3e",T=d=>(N("data-v-1ed09217"),d=d(),z(),d),L={style:{"background-color":"transparent",height:"100%",overflow:"auto"}},$={style:{display:"flex","flex-direction":"row"}},q={href:"/"},D=T(()=>l("br",null,null,-1)),H=T(()=>l("p",{style:{color:"#FFF",margin:"auto","text-align":"center"}},"Press ESC to close.",-1)),U={key:0,style:{display:"flex","justify-content":"center","margin-bottom":"10px"}},G={__name:"Poll",setup(d){var b=!1;const F=c(!1),v=c(!1),a=c("#FFF"),s=c("Please answer all questions."),n=c(!1),k=c(!1),m=c(null);let e=!1;const r=document.location.pathname.split("/").filter(t=>t.length!=0)[1];let i;function C(){document.location.href=window.location.protocol+"//"+window.location.host+"/res/"+r}function M(){document.location.href=window.location.protocol+"//"+window.location.host+"/create/"+r}async function x(t){const o=j(t);if(!o.ok){e=!0,a.value="#F00",s.value=o.message,n.value.showModal();return}o.res==0&&(F.value=!0),i=o.yaml,e=!0,i.allow==0?e=!1:(i.allow&y.CLIENT&&(localStorage.getItem("answered_"+r)=="y"?(a.value="#FFF",s.value="You already answered this poll.",n.value.showModal(),e=!0):e=!1),e&&i.allow&y.AUTH&&(e=!0,await(await fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"aa",n:r})})).text()!="y"?e=!1:(a.value="#FFF",s.value="You already answered this poll.",n.value.showModal()))),V(m.value,i),e||(k.value=!0)}S(()=>b=!0),fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"get",n:r})}).then(t=>t.json().then(o=>(o.is_creator&&(v.value=!0),o.login&&(window.location.href=window.location.protocol+"//"+window.location.host+"/login"),b?x(o.yaml):S(()=>x(o.yaml)))));function I(){if(e)return;e=!0;const t=A(m.value,i);if(!t.ok){a.value="#F00",s.value=t.message,n.value.showModal(),e=!1;return}a.value="#FFF",s.value="Please wait, submitting...",n.value.showModal(),fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"submit",n:r,r:t.answers})}).then(o=>o.text().then(u=>{!o.ok&&u==""&&(u=o.statusText);const f=u=="ok";if(a.value=f?"#FFF":"#F00",s.value=f?"Your response has been recorded.":u,n.value.showModal(),!f){e=!1;return}i.allow!=0&&i.allow&y.CLIENT&&localStorage.setItem("answered_"+r,"y")})).catch(()=>{a.value="#F00",s.value="Failed to submit response.",n.value.showModal(),e=!1})}return(t,o)=>(p(),w("div",L,[l("div",$,[l("a",q,[l("input",{class:"left-btn",style:h({"background-image":`url("${_(E)}")`}),type:"button"},null,4)]),F.value||v.value?(p(),w("input",{key:0,onClick:C,class:"left-btn",style:h({"background-image":`url("${_(J)}")`}),type:"button"},null,4)):g("",!0),v.value?(p(),w("input",{key:1,onClick:M,class:"left-btn",style:h({"background-image":`url("${_(Y)}")`}),type:"button"},null,4)):g("",!0)]),l("dialog",{ref_key:"dlg",ref:n,style:{"background-color":"#2B2B2B",border:"none","border-radius":"10px"}},[l("h1",{style:h({color:a.value})},B(s.value),5),D,H],512),l("div",{ref_key:"poll",ref:m},null,512),k.value?(p(),w("div",U,[l("button",{onClick:I},"Submit")])):g("",!0)]))}},K=P(G,[["__scopeId","data-v-1ed09217"]]);O(K).mount("#app");
