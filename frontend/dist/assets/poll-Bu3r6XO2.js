import{_ as P,r as n,g as Y,o as v,c as p,a as u,n as m,u as i,b as h,t as C,p as V,e as $,f as A}from"./_plugin-vue_export-helper-DBQglHaf.js";import{a as S,l as M}from"./common-Bjy0tg9W.js";import{v as L,A as T,d as O,r as j,g as J}from"./poll_loader-DlehWYRP.js";import{h as q,e as D,l as G,a as H}from"./logout-C7V15774.js";const K="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='white'%20d='M2%2021v-2h20v2zm1-3v-7h3v7zm5%200V6h3v12zm5%200V9h3v9zm5%200V3h3v15z'/%3e%3c/svg%3e",I=g=>(V("data-v-561a2bf0"),g=g(),$(),g),Q={style:{"background-color":"transparent",height:"100%",overflow:"auto"}},R={style:{display:"flex","flex-direction":"row"}},U={href:"/"},W=I(()=>u("br",null,null,-1)),X=I(()=>u("p",{style:{color:"#FFF",margin:"auto","text-align":"center"}},"Press ESC to close.",-1)),Z={key:0,style:{display:"flex","justify-content":"center","margin-bottom":"10px"}},ee={__name:"Poll",setup(g){const k=n("Submit"),_=n(!1),w=n(!1),o=n("#FFF"),a=n("Please answer all questions."),s=n(!1),y=n(!1),f=n(null),d=JSON.parse(document.getElementById("server-data").innerText),x=n(d.auth);let t=!1;const F=document.location.pathname.split("/").filter(l=>l.length!=0)[1];let c;d.is_creator&&(w.value=!0),d.can_res&&(_.value=!0),Y(()=>E(d));function B(){document.location.href=window.location.protocol+"//"+window.location.host+"/res/"+d.id}function z(){document.location.href=window.location.protocol+"//"+window.location.host+"/create/"+d.id}function E(l){if(l.yaml!=null){const e=L(l.yaml);if(!e.ok){t=!0,o.value="#F00",a.value=e.message,s.value.showModal();return}e.res==0&&(_.value=!0),c=e.yaml,t=!0,c.allow==0?t=!1:c.allow&T.CLIENT&&localStorage.getItem("answered_"+F)=="y"?(o.value="#FFF",a.value="You already answered this poll.",s.value.showModal(),t=!0):t=!1,O(f.value,c),!t&&l.prev_ans.length>0&&(j(f.value,e.yaml,l.prev_ans),o.value="#FFF",a.value="You already answered this poll.",s.value.showModal(),k.value="Change answers")}else{const e=document.createElement("h1");e.innerText="You don't have permission to view this poll.",e.style.color="#FFF",e.style.margin="auto",e.style.textAlign="center",f.value.appendChild(e)}l.closed?(t=!0,o.value="#F00",a.value="This poll is already closed.",s.value.showModal()):l.can_vote||(t=!0,o.value="#F00",a.value="You do not have permission to vote in this poll.",s.value.showModal()),t||(y.value=!0)}function N(){if(t)return;t=!0;const l=J(f.value,c);if(!l.ok){o.value="#F00",a.value=l.message,s.value.showModal(),t=!1;return}o.value="#FFF",a.value="Please wait, submitting...",s.value.showModal(),fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"submit",n:F,r:l.answers})}).then(e=>e.text().then(r=>{!e.ok&&r==""&&(r=e.statusText);const b=r=="ok";if(o.value=b?"#FFF":"#F00",a.value=b?"Your response has been recorded.":r,s.value.showModal(),!b){t=!1;return}t&&(y.value=!1),c.allow!=0&&c.allow&T.CLIENT&&localStorage.setItem("answered_"+F,"y"),setTimeout(()=>window.location.reload(!0),500)})).catch(()=>{o.value="#F00",a.value="Failed to submit response.",s.value.showModal(),t=!1})}return(l,e)=>(v(),p("div",Q,[u("div",R,[u("a",U,[u("input",{class:"left-btn",style:m({"background-image":`url("${i(q)}")`}),type:"button"},null,4)]),_.value||w.value?(v(),p("input",{key:0,onClick:B,class:"left-btn",style:m({"background-image":`url("${i(K)}")`}),type:"button"},null,4)):h("",!0),w.value?(v(),p("input",{key:1,onClick:z,class:"left-btn",style:m({"background-image":`url("${i(D)}")`}),type:"button"},null,4)):h("",!0),x.value?h("",!0):(v(),p("input",{key:2,onClick:e[0]||(e[0]=(...r)=>i(S)&&i(S)(...r)),class:"left-btn",style:m({"background-image":`url("${i(G)}")`}),type:"button"},null,4)),x.value?(v(),p("input",{key:3,onClick:e[1]||(e[1]=(...r)=>i(M)&&i(M)(...r)),class:"left-btn",style:m({"background-image":`url("${i(H)}")`}),type:"button"},null,4)):h("",!0)]),u("dialog",{ref_key:"dlg",ref:s,style:{"background-color":"#2B2B2B",border:"none","border-radius":"10px"}},[u("h1",{style:m({color:o.value})},C(a.value),5),W,X],512),u("div",{ref_key:"poll",ref:f},null,512),y.value?(v(),p("div",Z,[u("button",{onClick:N},C(k.value),1)])):h("",!0)]))}},te=P(ee,[["__scopeId","data-v-561a2bf0"]]);A(te).mount("#app");
