import{_ as B,r as c,f as S,o as w,c as v,a as l,n as p,u as g,g as _,t as I,p as L,d as P,e as q}from"./_plugin-vue_export-helper-DUaCvcyY.js";import{v as N,A as y,d as V,g as O}from"./poll_loader-CwpluAfJ.js";const j="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='white'%20d='M10%2020v-6h4v6h5v-8h3L12%203L2%2012h3v8z'/%3e%3c/svg%3e",A="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='white'%20d='M5%2021q-.825%200-1.412-.587T3%2019V5q0-.825.588-1.412T5%203h8.925l-2%202H5v14h14v-6.95l2-2V19q0%20.825-.587%201.413T19%2021zm4-6v-4.25l9.175-9.175q.3-.3.675-.45t.75-.15q.4%200%20.763.15t.662.45L22.425%203q.275.3.425.663T23%204.4t-.137.738t-.438.662L13.25%2015zM21.025%204.4l-1.4-1.4zM11%2013h1.4l5.8-5.8l-.7-.7l-.725-.7L11%2011.575zm6.5-6.5l-.725-.7zl.7.7z'/%3e%3c/svg%3e",E="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20width='1em'%20height='1em'%20viewBox='0%200%2024%2024'%3e%3cpath%20fill='white'%20d='M2%2021v-2h20v2zm1-3v-7h3v7zm5%200V6h3v12zm5%200V9h3v9zm5%200V3h3v15z'/%3e%3c/svg%3e",T=d=>(L("data-v-5b714989"),d=d(),P(),d),Y={style:{"background-color":"transparent",height:"100%",overflow:"auto"}},J={style:{display:"flex","flex-direction":"row"}},$={href:"/"},H=T(()=>l("br",null,null,-1)),D=T(()=>l("p",{style:{color:"#FFF",margin:"auto","text-align":"center"}},"Press ESC to close.",-1)),U={key:0,style:{display:"flex","justify-content":"center","margin-bottom":"10px"}},G={__name:"Poll",setup(d){var b=!1;const F=c(!0),f=c(!0),a=c("#FFF"),s=c("Please answer all questions."),n=c(!1),x=c(!1),m=c(null);let e=!1;const r=document.location.pathname.split("/").filter(o=>o.length!=0)[1];let i;function z(){document.location.href=window.location.protocol+"//"+window.location.host+"/res/"+r}function M(){document.location.href=window.location.protocol+"//"+window.location.host+"/create/"+r}async function k(o){const t=N(o);if(!t.ok){e=!0,a.value="#F00",s.value=t.message,n.value.showModal();return}t.res==0&&(F.value=!0),i=t.yaml,e=!0,i.allow==0?e=!1:(i.allow&y.CLIENT&&(localStorage.getItem("answered_"+r)=="y"?(a.value="#FFF",s.value="You already answered this poll.",n.value.showModal(),e=!0):e=!1),e&&i.allow&y.AUTH&&(e=!0,await(await fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"aa",n:r})})).text()!="y"?e=!1:(a.value="#FFF",s.value="You already answered this poll.",n.value.showModal()))),V(m.value,i),e||(x.value=!0)}S(()=>b=!0),fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"get",n:r})}).then(o=>o.json().then(t=>(t.is_creator&&(f.value=!0),t.login&&(window.location.href=window.location.protocol+"//"+window.location.host+"/login"),b?k(t.yaml):S(()=>k(t.yaml)))));function C(){if(e)return;e=!0;const o=O(m.value,i);if(!o.ok){a.value="#F00",s.value=o.message,n.value.showModal(),e=!1;return}a.value="#FFF",s.value="Please wait, submitting...",n.value.showModal(),fetch(window.location.protocol+"//"+window.location.host+"/gyatt",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({f:"submit",n:r,r:o.answers})}).then(t=>t.text().then(u=>{!t.ok&&u==""&&(u=t.statusText);const h=u=="ok";if(a.value=h?"#FFF":"#F00",s.value=h?"Your response has been recorded.":u,n.value.showModal(),!h){e=!1;return}i.allow!=0&&i.allow&y.CLIENT&&localStorage.setItem("answered_"+r,"y")})).catch(()=>{a.value="#F00",s.value="Failed to submit response.",n.value.showModal(),e=!1})}return(o,t)=>(w(),v("div",Y,[l("div",J,[l("a",$,[l("input",{class:"left-btn",style:p({"background-image":`url("${g(j)}")`}),type:"button"},null,4)]),F.value||f.value?(w(),v("input",{key:0,onClick:z,class:"left-btn",style:p({"background-image":`url("${g(E)}")`}),type:"button"},null,4)):_("",!0),f.value?(w(),v("input",{key:1,onClick:M,class:"left-btn",style:p({"background-image":`url("${g(A)}")`}),type:"button"},null,4)):_("",!0)]),l("dialog",{ref_key:"dlg",ref:n,style:{"background-color":"#2B2B2B",border:"none","border-radius":"10px"}},[l("h1",{style:p({color:a.value})},I(s.value),5),H,D],512),l("div",{ref_key:"poll",ref:m},null,512),x.value?(w(),v("div",U,[l("button",{onClick:C},"Submit")])):_("",!0)]))}},K=B(G,[["__scopeId","data-v-5b714989"]]);q(K).mount("#app");
